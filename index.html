<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fridge Inventory Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCpbaIxV6nDIose-RdRYeC-3-eH-oIsaRA",
            authDomain: "fridge-tracker-home.firebaseapp.com",
            databaseURL: "https://fridge-tracker-home-default-rtdb.firebaseio.com",
            projectId: "fridge-tracker-home",
            storageBucket: "fridge-tracker-home.firebasestorage.app",
            messagingSenderId: "580588734189",
            appId: "1:580588734189:web:c8c0c03a0fcc509707aee4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const { useState, useEffect } = React;
        
        // Create icon components
        const Icon = ({ icon, className = "w-5 h-5" }) => {
            const icons = {
                Plus: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                ),
                Minus: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
                    </svg>
                ),
                Search: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                ),
                AlertCircle: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Clock: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Package: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                ),
                Cloud: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                ),
                CloudOff: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3l18 18M5.94 5.94A10 10 0 0016.5 19.67M9 5a7 7 0 018.39 9.88M13 19.58A5 5 0 018.4 9.63" />
                    </svg>
                )
            };
            
            const IconComponent = icons[icon];
            return IconComponent ? <IconComponent /> : null;
        };

        const FridgeInventory = () => {
            const [currentUser, setCurrentUser] = useState('');
            const [showUserModal, setShowUserModal] = useState(true);
            const [items, setItems] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('All');
            const [showAddForm, setShowAddForm] = useState(false);
            const [loading, setLoading] = useState(true);
            const [connected, setConnected] = useState(true);
            const [newItem, setNewItem] = useState({
                name: '',
                quantity: 1,
                unit: 'pieces',
                category: 'Produce',
                expirationDate: '',
                lowStockThreshold: 1
            });

            const categories = ['All', 'Dairy', 'Produce', 'Beverages', 'Frozen', 'Pantry', 'Condiments', 'Leftovers'];
            const units = ['pieces', 'kg', 'g', 'litres', 'mL', 'cups', 'bottles', 'cans', 'servings', 'slices', 'carton', 'bags', 'bunches'];

            // Check for saved username
            useEffect(() => {
                const savedUser = localStorage.getItem('fridgeTrackerUser');
                if (savedUser) {
                    setCurrentUser(savedUser);
                    setShowUserModal(false);
                }
            }, []);

            // Set up Firebase listeners
            useEffect(() => {
                if (!showUserModal) {
                    // Connection state listener
                    const connectedRef = database.ref('.info/connected');
                    connectedRef.on('value', (snap) => {
                        setConnected(snap.val() === true);
                    });

                    // Items listener
                    const itemsRef = database.ref('items');
                    itemsRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const itemsList = Object.entries(data).map(([key, value]) => ({
                                ...value,
                                id: key
                            }));
                            setItems(itemsList);
                        } else {
                            setItems([]);
                            // Initialize with sample data if empty
                            const sampleItems = [
                                {
                                    name: 'Orange Juice',
                                    quantity: 2,
                                    unit: 'litres',
                                    category: 'Beverages',
                                    expirationDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                    lowStockThreshold: 1,
                                    lastUpdatedBy: 'System',
                                    lastUpdated: new Date().toISOString()
                                },
                                {
                                    name: 'Egg Whites',
                                    quantity: 500,
                                    unit: 'mL',
                                    category: 'Dairy',
                                    expirationDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                    lowStockThreshold: 100,
                                    lastUpdatedBy: 'System',
                                    lastUpdated: new Date().toISOString()
                                },
                                {
                                    name: 'Milk',
                                    quantity: 4,
                                    unit: 'litres',
                                    category: 'Dairy',
                                    expirationDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                    lowStockThreshold: 1,
                                    lastUpdatedBy: 'System',
                                    lastUpdated: new Date().toISOString()
                                },
                                {
                                    name: 'Leftover Pizza',
                                    quantity: 4,
                                    unit: 'slices',
                                    category: 'Leftovers',
                                    expirationDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                    lowStockThreshold: 1,
                                    lastUpdatedBy: 'System',
                                    lastUpdated: new Date().toISOString()
                                }
                            ];

                            sampleItems.forEach(item => {
                                database.ref('items').push(item);
                            });
                        }
                        setLoading(false);
                    });

                    return () => {
                        connectedRef.off();
                        itemsRef.off();
                    };
                }
            }, [showUserModal]);

            const handleUserSubmit = () => {
                if (currentUser.trim()) {
                    localStorage.setItem('fridgeTrackerUser', currentUser);
                    setShowUserModal(false);
                }
            };

            const updateQuantity = async (id, delta) => {
                const item = items.find(item => item.id === id);
                if (item) {
                    const newQuantity = Math.max(0, item.quantity + delta);
                    database.ref(`items/${id}`).update({
                        quantity: newQuantity,
                        lastUpdatedBy: currentUser,
                        lastUpdated: new Date().toISOString()
                    });
                }
            };

            const addItem = async () => {
                if (newItem.name && newItem.expirationDate) {
                    const item = {
                        ...newItem,
                        lastUpdatedBy: currentUser,
                        lastUpdated: new Date().toISOString()
                    };
                    database.ref('items').push(item);
                    setNewItem({
                        name: '',
                        quantity: 1,
                        unit: 'pieces',
                        category: 'Produce',
                        expirationDate: '',
                        lowStockThreshold: 1
                    });
                    setShowAddForm(false);
                }
            };

            const deleteItem = async (id) => {
                database.ref(`items/${id}`).remove();
            };

            const getDaysUntilExpiration = (expirationDate) => {
                const today = new Date();
                const expDate = new Date(expirationDate);
                const diffTime = expDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            const getExpirationClass = (expirationDate) => {
                const days = getDaysUntilExpiration(expirationDate);
                if (days <= 0) return 'bg-red-100 border-red-300';
                if (days <= 3) return 'bg-yellow-100 border-yellow-300';
                return 'bg-white';
            };

            const isLowStock = (item) => {
                return item.quantity <= item.lowStockThreshold;
            };

            const filteredItems = items.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'All' || item.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            const getStats = () => {
                const lowStockCount = items.filter(isLowStock).length;
                const expiringCount = items.filter(item => getDaysUntilExpiration(item.expirationDate) <= 3).length;
                return { total: items.length, lowStock: lowStockCount, expiring: expiringCount };
            };

            const stats = getStats();

            if (showUserModal) {
                return (
                    <div className="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg p-6 max-w-sm w-full">
                            <h2 className="text-2xl font-bold mb-4">Welcome to Fridge Tracker</h2>
                            <div>
                                <input
                                    type="text"
                                    placeholder="Enter your name"
                                    className="w-full p-3 border rounded-lg mb-4"
                                    value={currentUser}
                                    onChange={(e) => setCurrentUser(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleUserSubmit()}
                                    autoFocus
                                />
                                <button
                                    onClick={handleUserSubmit}
                                    className="w-full bg-blue-500 text-white p-3 rounded-lg font-semibold hover:bg-blue-600"
                                >
                                    Start Tracking
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p className="text-gray-600">Connecting to Firebase...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="p-4">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-2xl font-bold">Fridge Inventory</h1>
                                <div className="text-right">
                                    <div className="text-sm text-gray-600 flex items-center gap-2 justify-end">
                                        {connected ? (
                                            <Icon icon="Cloud" className="w-4 h-4 text-green-500" />
                                        ) : (
                                            <Icon icon="CloudOff" className="w-4 h-4 text-red-500" />
                                        )}
                                        <span>User: {currentUser}</span>
                                    </div>
                                    <button 
                                        onClick={() => {
                                            localStorage.removeItem('fridgeTrackerUser');
                                            setCurrentUser('');
                                            setShowUserModal(true);
                                        }}
                                        className="text-xs text-blue-500 hover:underline"
                                    >
                                        Change User
                                    </button>
                                </div>
                            </div>

                            {!connected && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                                    <p className="text-sm text-red-800">
                                        <strong>Offline:</strong> Changes will sync when connection is restored
                                    </p>
                                </div>
                            )}
                            
                            <div className="grid grid-cols-3 gap-3 mb-4">
                                <div className="bg-blue-100 p-3 rounded-lg text-center">
                                    <Icon icon="Package" className="w-5 h-5 mx-auto mb-1 text-blue-600" />
                                    <div className="text-xl font-bold">{stats.total}</div>
                                    <div className="text-xs text-gray-700">Total Items</div>
                                </div>
                                <div className="bg-yellow-100 p-3 rounded-lg text-center">
                                    <Icon icon="AlertCircle" className="w-5 h-5 mx-auto mb-1 text-yellow-600" />
                                    <div className="text-xl font-bold">{stats.lowStock}</div>
                                    <div className="text-xs text-gray-700">Low Stock</div>
                                </div>
                                <div className="bg-red-100 p-3 rounded-lg text-center">
                                    <Icon icon="Clock" className="w-5 h-5 mx-auto mb-1 text-red-600" />
                                    <div className="text-xl font-bold">{stats.expiring}</div>
                                    <div className="text-xs text-gray-700">Expiring Soon</div>
                                </div>
                            </div>

                            <div className="flex gap-2 mb-4">
                                <div className="relative flex-1">
                                    <Icon icon="Search" className="absolute left-3 top-3 w-4 h-4 text-gray-400" />
                                    <input
                                        type="text"
                                        placeholder="Search items..."
                                        className="w-full pl-10 pr-3 py-2 border rounded-lg"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <button
                                    onClick={() => setShowAddForm(true)}
                                    className="bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-600"
                                >
                                    <Icon icon="Plus" className="w-4 h-4" />
                                    Add
                                </button>
                            </div>

                            <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => setSelectedCategory(cat)}
                                        className={`px-3 py-1 rounded-full text-sm whitespace-nowrap ${
                                            selectedCategory === cat
                                                ? 'bg-blue-500 text-white'
                                                : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="p-4">
                        {filteredItems.length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                                <Icon icon="Package" className="w-12 h-12 mx-auto mb-3 text-gray-300" />
                                <p>No items found</p>
                                <p className="text-sm mt-1">Add some items to get started!</p>
                            </div>
                        ) : (
                            filteredItems.map(item => {
                                const daysUntilExpiration = getDaysUntilExpiration(item.expirationDate);
                                const lowStock = isLowStock(item);
                                
                                return (
                                    <div
                                        key={item.id}
                                        className={`mb-3 p-4 rounded-lg border ${getExpirationClass(item.expirationDate)}`}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-lg">{item.name}</h3>
                                                <div className="text-sm text-gray-600">
                                                    {item.category} • Updated by {item.lastUpdatedBy}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => deleteItem(item.id)}
                                                className="text-red-500 text-sm hover:text-red-700"
                                            >
                                                Remove
                                            </button>
                                        </div>

                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={() => updateQuantity(item.id, -1)}
                                                    className="bg-gray-200 p-2 rounded-lg hover:bg-gray-300"
                                                >
                                                    <Icon icon="Minus" className="w-4 h-4" />
                                                </button>
                                                <div className="text-center">
                                                    <div className="text-xl font-bold">
                                                        {item.quantity} {item.unit}
                                                    </div>
                                                    {lowStock && (
                                                        <div className="text-xs text-red-600 font-semibold">Low Stock!</div>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => updateQuantity(item.id, 1)}
                                                    className="bg-gray-200 p-2 rounded-lg hover:bg-gray-300"
                                                >
                                                    <Icon icon="Plus" className="w-4 h-4" />
                                                </button>
                                            </div>

                                            <div className="text-right">
                                                <div className="text-sm text-gray-600">Expires in</div>
                                                <div className={`font-semibold ${daysUntilExpiration <= 3 ? 'text-red-600' : 'text-gray-800'}`}>
                                                    {daysUntilExpiration} days
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mt-3 flex gap-2">
                                            <button
                                                onClick={() => updateQuantity(item.id, -1)}
                                                className="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200"
                                            >
                                                I used 1
                                            </button>
                                            {item.quantity > 2 && (
                                                <button
                                                    onClick={() => updateQuantity(item.id, -Math.floor(item.quantity / 2))}
                                                    className="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200"
                                                >
                                                    I used half
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>

                    {showAddForm && (
                        <div className="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-20">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <h2 className="text-xl font-bold mb-4">Add New Item</h2>
                                <div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Item Name</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.name}
                                            onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Quantity</label>
                                            <input
                                                type="number"
                                                min="0"
                                                step="0.1"
                                                className="w-full p-2 border rounded-lg"
                                                value={newItem.quantity}
                                                onChange={(e) => setNewItem({...newItem, quantity: parseFloat(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Unit</label>
                                            <select
                                                className="w-full p-2 border rounded-lg"
                                                value={newItem.unit}
                                                onChange={(e) => setNewItem({...newItem, unit: e.target.value})}
                                            >
                                                {units.map(unit => (
                                                    <option key={unit} value={unit}>{unit}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Category</label>
                                        <select
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.category}
                                            onChange={(e) => setNewItem({...newItem, category: e.target.value})}
                                        >
                                            {categories.filter(cat => cat !== 'All').map(cat => (
                                                <option key={cat} value={cat}>{cat}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Expiration Date</label>
                                        <input
                                            type="date"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.expirationDate}
                                            min={new Date().toISOString().split('T')[0]}
                                            onChange={(e) => setNewItem({...newItem, expirationDate: e.target.value})}
                                        />
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Low Stock Alert (when quantity reaches)</label>
                                        <input
                                            type="number"
                                            min="0"
                                            step="0.1"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.lowStockThreshold}
                                            onChange={(e) => setNewItem({...newItem, lowStockThreshold: parseFloat(e.target.value)})}
                                        />
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={addItem}
                                            className="flex-1 bg-blue-500 text-white p-3 rounded-lg font-semibold hover:bg-blue-600"
                                        >
                                            Add Item
                                        </button>
                                        <button
                                            onClick={() => setShowAddForm(false)}
                                            className="flex-1 bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FridgeInventory />);
    </script>
</body>
</html>
                                        