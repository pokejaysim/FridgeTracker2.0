<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fridge Inventory Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <!-- Barcode Scanner Library -->
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.2/dist/quagga.min.js"></script>
    
    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Barcode scanner styles */
        #scanner-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #scanner-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #scanner-container .drawingBuffer {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCpbaIxV6nDIose-RdRYeC-3-eH-oIsaRA",
            authDomain: "fridge-tracker-home.firebaseapp.com",
            databaseURL: "https://fridge-tracker-home-default-rtdb.firebaseio.com",
            projectId: "fridge-tracker-home",
            storageBucket: "fridge-tracker-home.firebasestorage.app",
            messagingSenderId: "580588734189",
            appId: "1:580588734189:web:c8c0c03a0fcc509707aee4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Set up Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        const { useState, useEffect } = React;
        
        // Create icon components
        const Icon = ({ icon, className = "w-5 h-5" }) => {
            const icons = {
                Plus: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                ),
                Minus: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
                    </svg>
                ),
                Search: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                ),
                AlertCircle: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Clock: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Package: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                ),
                Cloud: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                ),
                CloudOff: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3l18 18M5.94 5.94A10 10 0 0016.5 19.67M9 5a7 7 0 018.39 9.88M13 19.58A5 5 0 018.4 9.63" />
                    </svg>
                ),
                Google: () => (
                    <svg className={className} viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                ),
                LogOut: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                ),
                User: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                ),
                Home: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                ),
                Building: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                ),
                ChevronDown: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                    </svg>
                ),
                Sparkles: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                    </svg>
                ),
                Camera: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                ),
                X: () => (
                    <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                )
            };
            
            const IconComponent = icons[icon];
            return IconComponent ? <IconComponent /> : null;
        };

        const FridgeInventory = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [authLoading, setAuthLoading] = useState(true);
            const [items, setItems] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('All');
            const [showAddForm, setShowAddForm] = useState(false);
            const [connected, setConnected] = useState(true);
            const [showHouseholdDropdown, setShowHouseholdDropdown] = useState(false);
            const [showBarcodeScanner, setShowBarcodeScanner] = useState(false);
            const [scannerActive, setScannerActive] = useState(false);
            const [barcodeResult, setBarcodeResult] = useState('');
            const [productLookupLoading, setProductLookupLoading] = useState(false);
            const [newItem, setNewItem] = useState({
                name: '',
                quantity: 1,
                unit: 'pieces',
                category: 'Produce',
                expirationDate: '',
                lowStockThreshold: 1
            });

            // Household management
            const households = [
                { id: 'poco', name: 'Poco', icon: 'Home' },
                { id: 'vancouver', name: 'Vancouver', icon: 'Building' }
            ];
            const [currentHousehold, setCurrentHousehold] = useState('poco');

            const categories = ['All', 'Dairy', 'Produce', 'Beverages', 'Frozen', 'Pantry', 'Condiments', 'Leftovers'];
            const units = ['pieces', 'kg', 'g', 'litres', 'mL', 'cups', 'bottles', 'cans', 'servings', 'slices', 'carton', 'bags', 'bunches'];

            // Load saved household preference
            useEffect(() => {
                const savedHousehold = localStorage.getItem('selectedHousehold');
                if (savedHousehold && households.find(h => h.id === savedHousehold)) {
                    setCurrentHousehold(savedHousehold);
                }
            }, []);

            // Save household preference when changed
            const handleHouseholdChange = (householdId) => {
                setCurrentHousehold(householdId);
                localStorage.setItem('selectedHousehold', householdId);
                setShowHouseholdDropdown(false);
            };

            // Auth state listener
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setAuthLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // Database listeners (only when authenticated)
            useEffect(() => {
                if (user && currentHousehold) {
                    setLoading(true);
                    
                    // Connection state listener
                    const connectedRef = database.ref('.info/connected');
                    connectedRef.on('value', (snap) => {
                        setConnected(snap.val() === true);
                    });

                    // Items listener for current household
                    const itemsRef = database.ref(`households/${currentHousehold}/items`);
                    itemsRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const itemsList = Object.entries(data).map(([key, value]) => ({
                                ...value,
                                id: key
                            }));
                            setItems(itemsList);
                        } else {
                            setItems([]);
                        }
                        setLoading(false);
                    });

                    return () => {
                        connectedRef.off();
                        itemsRef.off();
                    };
                }
            }, [user, currentHousehold]);

            const signInWithGoogle = async () => {
                try {
                    await auth.signInWithPopup(googleProvider);
                } catch (error) {
                    console.error("Error signing in:", error);
                    alert("Error signing in. Please try again.");
                }
            };

            const signOut = async () => {
                try {
                    await auth.signOut();
                    setItems([]);
                } catch (error) {
                    console.error("Error signing out:", error);
                }
            };

            const updateQuantity = async (id, delta) => {
                const item = items.find(item => item.id === id);
                if (item) {
                    const newQuantity = Math.max(0, item.quantity + delta);
                    database.ref(`households/${currentHousehold}/items/${id}`).update({
                        quantity: newQuantity,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    });
                }
            };

            const addItem = async () => {
                if (newItem.name && newItem.expirationDate) {
                    const item = {
                        ...newItem,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    };
                    database.ref(`households/${currentHousehold}/items`).push(item);
                    setNewItem({
                        name: '',
                        quantity: 1,
                        unit: 'pieces',
                        category: 'Produce',
                        expirationDate: '',
                        lowStockThreshold: 1
                    });
                    setShowAddForm(false);
                }
            };

            // Barcode scanning functions
            const startBarcodeScanner = () => {
                setShowBarcodeScanner(true);
                setScannerActive(true);
                setBarcodeResult('');
                
                setTimeout(() => {
                    if (typeof Quagga !== 'undefined') {
                        Quagga.init({
                            inputStream: {
                                type: "LiveStream",
                                target: document.querySelector('#scanner-container'),
                                constraints: {
                                    facingMode: "environment",
                                    width: { ideal: 1280 },
                                    height: { ideal: 720 }
                                }
                            },
                            decoder: {
                                readers: [
                                    "ean_reader",
                                    "ean_8_reader",
                                    "upc_reader",
                                    "upc_e_reader",
                                    "code_128_reader",
                                    "code_39_reader"
                                ]
                            },
                            locate: true,
                            frequency: 10
                        }, (err) => {
                            if (err) {
                                console.error("Barcode scanner initialization failed:", err);
                                alert("Camera access denied or not available");
                                setShowBarcodeScanner(false);
                                setScannerActive(false);
                                return;
                            }
                            Quagga.start();
                        });

                        Quagga.onDetected((result) => {
                            const code = result.codeResult.code;
                            setBarcodeResult(code);
                            Quagga.stop();
                            setScannerActive(false);
                            lookupProduct(code);
                        });
                    }
                }, 100);
            };

            const stopBarcodeScanner = () => {
                if (typeof Quagga !== 'undefined' && scannerActive) {
                    Quagga.stop();
                }
                setShowBarcodeScanner(false);
                setScannerActive(false);
                setBarcodeResult('');
            };

            const lookupProduct = async (barcode) => {
                setProductLookupLoading(true);
                
                try {
                    // Using Open Food Facts API - free and open database
                    const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`);
                    const data = await response.json();
                    
                    if (data.status === 1 && data.product) {
                        const product = data.product;
                        
                        // Auto-fill form with product data
                        setNewItem(prev => ({
                            ...prev,
                            name: product.product_name || `Product ${barcode}`,
                            category: guessCategory(product),
                            // Suggest default quantity and unit based on product
                            quantity: 1,
                            unit: guessUnit(product)
                        }));
                        
                        setShowBarcodeScanner(false);
                        setShowAddForm(true);
                    } else {
                        // Product not found - still open form with barcode
                        setNewItem(prev => ({
                            ...prev,
                            name: `Product ${barcode}`
                        }));
                        setShowBarcodeScanner(false);
                        setShowAddForm(true);
                    }
                } catch (error) {
                    console.error("Product lookup failed:", error);
                    // On error, still let user add item manually
                    setNewItem(prev => ({
                        ...prev,
                        name: `Product ${barcode}`
                    }));
                    setShowBarcodeScanner(false);
                    setShowAddForm(true);
                } finally {
                    setProductLookupLoading(false);
                }
            };

            const guessCategory = (product) => {
                const categories_tags = product.categories_tags || [];
                const productName = (product.product_name || '').toLowerCase();
                
                // Check for dairy
                if (categories_tags.some(tag => tag.includes('dairy')) || 
                    productName.includes('milk') || productName.includes('cheese') || 
                    productName.includes('yogurt')) {
                    return 'Dairy';
                }
                
                // Check for beverages
                if (categories_tags.some(tag => tag.includes('beverage')) || 
                    productName.includes('drink') || productName.includes('juice') || 
                    productName.includes('soda')) {
                    return 'Beverages';
                }
                
                // Check for frozen
                if (categories_tags.some(tag => tag.includes('frozen'))) {
                    return 'Frozen';
                }
                
                // Check for condiments
                if (categories_tags.some(tag => tag.includes('condiment')) || 
                    productName.includes('sauce') || productName.includes('ketchup')) {
                    return 'Condiments';
                }
                
                // Default to Pantry for packaged goods
                return 'Pantry';
            };

            const guessUnit = (product) => {
                const quantity = product.quantity || '';
                
                if (quantity.includes('ml') || quantity.includes('mL')) return 'mL';
                if (quantity.includes('l') || quantity.includes('L')) return 'litres';
                if (quantity.includes('kg')) return 'kg';
                if (quantity.includes('g')) return 'g';
                
                // Default to pieces for most products
                return 'pieces';
            };

            const deleteItem = async (id) => {
                database.ref(`households/${currentHousehold}/items/${id}`).remove();
            };

            const addSampleData = async () => {
                const sampleItems = [
                    {
                        name: 'Orange Juice',
                        quantity: 2,
                        unit: 'litres',
                        category: 'Beverages',
                        expirationDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        lowStockThreshold: 1,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    },
                    {
                        name: 'Egg Whites',
                        quantity: 500,
                        unit: 'mL',
                        category: 'Dairy',
                        expirationDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        lowStockThreshold: 100,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    },
                    {
                        name: 'Milk',
                        quantity: 4,
                        unit: 'litres',
                        category: 'Dairy',
                        expirationDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        lowStockThreshold: 1,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    },
                    {
                        name: 'Leftover Pizza',
                        quantity: 4,
                        unit: 'slices',
                        category: 'Leftovers',
                        expirationDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        lowStockThreshold: 1,
                        lastUpdatedBy: user.displayName || user.email,
                        lastUpdated: new Date().toISOString()
                    }
                ];

                sampleItems.forEach(item => {
                    database.ref(`households/${currentHousehold}/items`).push(item);
                });
            };

            const getDaysUntilExpiration = (expirationDate) => {
                const today = new Date();
                const expDate = new Date(expirationDate);
                const diffTime = expDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            const getExpirationClass = (expirationDate) => {
                const days = getDaysUntilExpiration(expirationDate);
                if (days <= 0) return 'bg-red-100 border-red-300';
                if (days <= 3) return 'bg-yellow-100 border-yellow-300';
                return 'bg-white';
            };

            const isLowStock = (item) => {
                return item.quantity <= item.lowStockThreshold;
            };

            const filteredItems = items.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'All' || item.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            const getStats = () => {
                const lowStockCount = items.filter(isLowStock).length;
                const expiringCount = items.filter(item => getDaysUntilExpiration(item.expirationDate) <= 3).length;
                return { total: items.length, lowStock: lowStockCount, expiring: expiringCount };
            };

            const stats = getStats();
            const currentHouseholdData = households.find(h => h.id === currentHousehold);

            // Show loading while checking auth
            if (authLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            // Show login screen if not authenticated
            if (!user) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <Icon icon="Package" className="w-16 h-16 mx-auto mb-4 text-blue-500" />
                                <h1 className="text-3xl font-bold mb-2">Fridge Inventory Tracker</h1>
                                <p className="text-gray-600">Sign in to manage your household inventory</p>
                            </div>
                            
                            <button
                                onClick={signInWithGoogle}
                                className="w-full bg-white border border-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium hover:bg-gray-50 flex items-center justify-center gap-3 transition-colors"
                            >
                                <Icon icon="Google" className="w-5 h-5" />
                                Sign in with Google
                            </button>
                            
                            <p className="text-xs text-gray-500 text-center mt-6">
                                Your data is private and only accessible to signed-in users
                            </p>
                        </div>
                    </div>
                );
            }

            // Show loading while fetching data
            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading inventory...</p>
                        </div>
                    </div>
                );
            }

            // Main app UI
            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="p-4">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-2xl font-bold">Fridge Inventory</h1>
                                
                                {/* Household Selector */}
                                <div className="relative">
                                    <button
                                        onClick={() => setShowHouseholdDropdown(!showHouseholdDropdown)}
                                        className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors"
                                    >
                                        <Icon icon={currentHouseholdData.icon} className="w-4 h-4 text-gray-600" />
                                        <span className="font-medium">{currentHouseholdData.name}</span>
                                        <Icon icon="ChevronDown" className="w-4 h-4 text-gray-500" />
                                    </button>
                                    
                                    {showHouseholdDropdown && (
                                        <div className="absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[150px]">
                                            {households.map(household => (
                                                <button
                                                    key={household.id}
                                                    onClick={() => handleHouseholdChange(household.id)}
                                                    className={`w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-50 transition-colors ${
                                                        currentHousehold === household.id ? 'bg-blue-50 text-blue-600' : ''
                                                    }`}
                                                >
                                                    <Icon icon={household.icon} className="w-4 h-4" />
                                                    <span>{household.name}</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="text-right">
                                    <div className="text-sm text-gray-600 flex items-center gap-2 justify-end">
                                        {connected ? (
                                            <Icon icon="Cloud" className="w-4 h-4 text-green-500" />
                                        ) : (
                                            <Icon icon="CloudOff" className="w-4 h-4 text-red-500" />
                                        )}
                                        <div className="flex items-center gap-1">
                                            {user.photoURL ? (
                                                <img src={user.photoURL} alt={user.displayName} className="w-6 h-6 rounded-full" />
                                            ) : (
                                                <Icon icon="User" className="w-4 h-4" />
                                            )}
                                            <span>{user.displayName || user.email}</span>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={signOut}
                                        className="text-xs text-blue-500 hover:underline flex items-center gap-1 ml-auto"
                                    >
                                        <Icon icon="LogOut" className="w-3 h-3" />
                                        Sign Out
                                    </button>
                                </div>
                            </div>

                            {!connected && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                                    <p className="text-sm text-red-800">
                                        <strong>Offline:</strong> Changes will sync when connection is restored
                                    </p>
                                </div>
                            )}
                            
                            <div className="grid grid-cols-3 gap-3 mb-4">
                                <div className="bg-blue-100 p-3 rounded-lg text-center">
                                    <Icon icon="Package" className="w-5 h-5 mx-auto mb-1 text-blue-600" />
                                    <div className="text-xl font-bold">{stats.total}</div>
                                    <div className="text-xs text-gray-700">Total Items</div>
                                </div>
                                <div className="bg-yellow-100 p-3 rounded-lg text-center">
                                    <Icon icon="AlertCircle" className="w-5 h-5 mx-auto mb-1 text-yellow-600" />
                                    <div className="text-xl font-bold">{stats.lowStock}</div>
                                    <div className="text-xs text-gray-700">Low Stock</div>
                                </div>
                                <div className="bg-red-100 p-3 rounded-lg text-center">
                                    <Icon icon="Clock" className="w-5 h-5 mx-auto mb-1 text-red-600" />
                                    <div className="text-xl font-bold">{stats.expiring}</div>
                                    <div className="text-xs text-gray-700">Expiring Soon</div>
                                </div>
                            </div>

                            <div className="flex gap-2 mb-4">
                                <div className="relative flex-1">
                                    <Icon icon="Search" className="absolute left-3 top-3 w-4 h-4 text-gray-400" />
                                    <input
                                        type="text"
                                        placeholder="Search items..."
                                        className="w-full pl-10 pr-3 py-2 border rounded-lg"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <button
                                    onClick={startBarcodeScanner}
                                    className="bg-green-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-600"
                                >
                                    <Icon icon="Camera" className="w-4 h-4" />
                                    Scan
                                </button>
                                <button
                                    onClick={() => setShowAddForm(true)}
                                    className="bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-600"
                                >
                                    <Icon icon="Plus" className="w-4 h-4" />
                                    Add
                                </button>
                            </div>

                            <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => setSelectedCategory(cat)}
                                        className={`px-3 py-1 rounded-full text-sm whitespace-nowrap ${
                                            selectedCategory === cat
                                                ? 'bg-blue-500 text-white'
                                                : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="p-4">
                        {filteredItems.length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                                <Icon icon="Package" className="w-12 h-12 mx-auto mb-3 text-gray-300" />
                                <p>No items found</p>
                                <p className="text-sm mt-1">Add some items to get started!</p>
                                {items.length === 0 && (
                                    <button
                                        onClick={addSampleData}
                                        className="mt-4 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-200 mx-auto"
                                    >
                                        <Icon icon="Sparkles" className="w-4 h-4" />
                                        Add Sample Items
                                    </button>
                                )}
                            </div>
                        ) : (
                            filteredItems.map(item => {
                                const daysUntilExpiration = getDaysUntilExpiration(item.expirationDate);
                                const lowStock = isLowStock(item);
                                
                                return (
                                    <div
                                        key={item.id}
                                        className={`mb-3 p-4 rounded-lg border ${getExpirationClass(item.expirationDate)}`}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-lg">{item.name}</h3>
                                                <div className="text-sm text-gray-600">
                                                    {item.category} â€¢ Updated by {item.lastUpdatedBy}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => deleteItem(item.id)}
                                                className="text-red-500 text-sm hover:text-red-700"
                                            >
                                                Remove
                                            </button>
                                        </div>

                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={() => updateQuantity(item.id, -1)}
                                                    className="bg-gray-200 p-2 rounded-lg hover:bg-gray-300"
                                                >
                                                    <Icon icon="Minus" className="w-4 h-4" />
                                                </button>
                                                <div className="text-center">
                                                    <div className="text-xl font-bold">
                                                        {item.quantity} {item.unit}
                                                    </div>
                                                    {lowStock && (
                                                        <div className="text-xs text-red-600 font-semibold">Low Stock!</div>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => updateQuantity(item.id, 1)}
                                                    className="bg-gray-200 p-2 rounded-lg hover:bg-gray-300"
                                                >
                                                    <Icon icon="Plus" className="w-4 h-4" />
                                                </button>
                                            </div>

                                            <div className="text-right">
                                                <div className="text-sm text-gray-600">Expires in</div>
                                                <div className={`font-semibold ${daysUntilExpiration <= 3 ? 'text-red-600' : 'text-gray-800'}`}>
                                                    {daysUntilExpiration} days
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mt-3 flex gap-2">
                                            <button
                                                onClick={() => updateQuantity(item.id, -1)}
                                                className="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200"
                                            >
                                                I used 1
                                            </button>
                                            {item.quantity > 2 && (
                                                <button
                                                    onClick={() => updateQuantity(item.id, -Math.floor(item.quantity / 2))}
                                                    className="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200"
                                                >
                                                    I used half
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>

                    {/* Barcode Scanner Modal */}
                    {showBarcodeScanner && (
                        <div className="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-20">
                            <div className="bg-white rounded-lg p-6 max-w-lg w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">Scan Barcode</h2>
                                    <button
                                        onClick={stopBarcodeScanner}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <Icon icon="X" className="w-6 h-6" />
                                    </button>
                                </div>
                                
                                {productLookupLoading ? (
                                    <div className="text-center py-8">
                                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                                        <p className="text-gray-600">Looking up product...</p>
                                        <p className="text-sm text-gray-500 mt-2">Barcode: {barcodeResult}</p>
                                    </div>
                                ) : (
                                    <>
                                        <div id="scanner-container" className="relative w-full h-64 bg-black rounded-lg overflow-hidden mb-4">
                                            {scannerActive && (
                                                <div className="absolute inset-0 flex items-center justify-center">
                                                    <div className="text-white text-center">
                                                        <p className="mb-2">Point camera at barcode</p>
                                                        <div className="animate-pulse">Scanning...</div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="text-center text-sm text-gray-600">
                                            <p>Position the barcode within the camera view</p>
                                            <p className="mt-1">Supports UPC, EAN, and other common formats</p>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 z-20">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <h2 className="text-xl font-bold mb-4">Add New Item to {currentHouseholdData.name}</h2>
                                <div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Item Name</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.name}
                                            onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Quantity</label>
                                            <input
                                                type="number"
                                                min="0"
                                                step="0.1"
                                                className="w-full p-2 border rounded-lg"
                                                value={newItem.quantity}
                                                onChange={(e) => setNewItem({...newItem, quantity: parseFloat(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Unit</label>
                                            <select
                                                className="w-full p-2 border rounded-lg"
                                                value={newItem.unit}
                                                onChange={(e) => setNewItem({...newItem, unit: e.target.value})}
                                            >
                                                {units.map(unit => (
                                                    <option key={unit} value={unit}>{unit}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Category</label>
                                        <select
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.category}
                                            onChange={(e) => setNewItem({...newItem, category: e.target.value})}
                                        >
                                            {categories.filter(cat => cat !== 'All').map(cat => (
                                                <option key={cat} value={cat}>{cat}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Expiration Date</label>
                                        <input
                                            type="date"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.expirationDate}
                                            min={new Date().toISOString().split('T')[0]}
                                            onChange={(e) => setNewItem({...newItem, expirationDate: e.target.value})}
                                        />
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Low Stock Alert (when quantity reaches)</label>
                                        <input
                                            type="number"
                                            min="0"
                                            step="0.1"
                                            className="w-full p-2 border rounded-lg"
                                            value={newItem.lowStockThreshold}
                                            onChange={(e) => setNewItem({...newItem, lowStockThreshold: parseFloat(e.target.value)})}
                                        />
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={addItem}
                                            className="flex-1 bg-blue-500 text-white p-3 rounded-lg font-semibold hover:bg-blue-600"
                                        >
                                            Add Item
                                        </button>
                                        <button
                                            onClick={() => setShowAddForm(false)}
                                            className="flex-1 bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FridgeInventory />);
    </script>
</body>
</html>